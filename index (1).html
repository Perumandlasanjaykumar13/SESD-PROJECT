<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FoodFinder ‚Äî Telangana Single-file</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f3f6fb; --card:#ffffff; --muted:#6b7280;
    --accent:#ff6b3c; --nav:#133f8a;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:#061024}
  header{background:linear-gradient(90deg,var(--nav),#0f67c2);color:#fff;padding:14px 18px;display:flex;align-items:center;gap:12px;position:sticky;top:0;z-index:50}
  header .logo{width:44px;height:44px;border-radius:10px;background:#fff;color:var(--nav);display:grid;place-items:center;font-weight:700}
  header h1{margin:0;font-size:18px}
  .container{max-width:1150px;margin:18px auto;padding:0 14px}
  .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:14px}
  .search{flex:1;display:flex;gap:8px}
  input[type="search"],select,textarea,input[type="text"]{padding:10px;border-radius:8px;border:1px solid #e4e8f2;background:white}
  button{background:var(--accent);border:none;color:#fff;padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:600}
  .btn-ghost{background:#fff;border:1px solid #e4e8f2;color:#174ea6;padding:8px 10px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:14px}
  .card{background:var(--card);border-radius:12px;overflow:hidden;box-shadow:0 8px 20px rgba(11,22,50,0.06);display:flex;flex-direction:column;transition:transform .16s}
  .card:hover{transform:translateY(-6px)}
  .hero{height:140px;background:linear-gradient(180deg,#eef6ff,#f8fbff);display:flex;align-items:center;justify-content:center;padding:10px}
  .hero img{width:100%;height:100%;object-fit:cover;border-radius:6px}
  .info{padding:10px;flex:1;display:flex;flex-direction:column;justify-content:space-between}
  .title{font-weight:700;margin:0}
  .meta{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
  .muted{color:var(--muted);font-size:13px}
  .rating{background:#073c83;color:#fff;padding:6px 10px;border-radius:18px;font-weight:700}
  .small{background:#f4f7ff;border:1px solid #e8eefc;color:#174ea6;padding:8px 10px;border-radius:8px;cursor:pointer}
  .sidebar{position:fixed;right:20px;bottom:18px;width:360px;background:linear-gradient(#fff,#fbfbff);padding:12px;border-radius:12px;box-shadow:0 18px 40px rgba(10,20,40,0.12);z-index:80;max-height:70vh;overflow:auto}
  .hidden{display:none}
  .modal-bg{position:fixed;inset:0;background:rgba(2,8,20,0.5);display:flex;align-items:center;justify-content:center;z-index:120}
  .modal{background:white;border-radius:12px;padding:16px;width:94%;max-width:900px;max-height:86vh;overflow:auto}
  .gallery{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .gallery img{width:140px;height:90px;object-fit:cover;border-radius:8px;border:1px solid #eee}
  footer{margin:28px 0 80px;text-align:center;color:var(--muted)}
  @media (max-width:820px){ .sidebar{position:static;width:92%;margin:12px auto;right:auto;bottom:auto} }
</style>
</head>
<body>
<header>
  <div class="logo">FD</div>
  <h1>FoodFinder ‚Äî Telangana</h1>
  <div style="flex:1"></div>
  <div id="signed-as" style="color:rgba(255,255,255,0.9);font-size:13px">Not signed in</div>
  <button id="signin-btn" class="btn btn-ghost" style="margin-left:8px">Sign In</button>
  <button id="cart-toggle" class="btn" style="margin-left:8px">Cart (0)</button>
</header>

<main class="container">
  <section class="controls" aria-label="Search and Filters">
    <div class="search" role="search">
      <input id="q" type="search" placeholder="Search restaurants, cuisine, city, dishes..." aria-label="Search">
      <select id="city-filter" aria-label="City"><option value="">All cities</option></select>
      <select id="cuisine-filter" aria-label="Cuisine"><option value="">All cuisines</option></select>
      <button id="search-btn">Search</button>
      <button id="reset-btn" class="btn-ghost">Reset</button>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <button id="show-favs" class="small">Favorites ‚ù§Ô∏è</button>
      <button id="admin-toggle" class="small">Admin</button>
      <button id="export-btn" class="small">Export</button>
    </div>
  </section>

  <section id="restaurants" class="grid" aria-live="polite"></section>

  <div style="margin-top:12px;color:var(--muted)">Demo: Telangana restaurants. SVG images are generated at runtime and are copyright-free.</div>
</main>

<!-- Cart sidebar -->
<aside id="cart" class="sidebar hidden" aria-hidden="true">
  <h3>Cart</h3>
  <div id="cart-items"></div>
  <div style="margin-top:10px;display:flex;justify-content:space-between"><strong>Total</strong><strong>‚Çπ<span id="cart-total">0</span></strong></div>
  <div style="display:flex;gap:8px;margin-top:10px">
    <button id="checkout" class="btn">Checkout</button>
    <button id="clear-cart" class="small">Clear</button>
    <button id="close-cart" class="small">Close</button>
  </div>
</aside>

<!-- Admin panel -->
<aside id="admin-panel" class="sidebar hidden" style="left:20px;right:auto">
  <h3>Admin (local)</h3>
  <div style="font-size:13px;color:var(--muted);margin-bottom:8px">Add restaurant locally (stored to browser)</div>
  <input id="adm-name" type="text" placeholder="Name" style="width:100%;margin-bottom:6px;padding:8px;border-radius:6px;border:1px solid #eee"/>
  <input id="adm-cuisine" type="text" placeholder="Cuisine" style="width:100%;margin-bottom:6px;padding:8px;border-radius:6px;border:1px solid #eee"/>
  <input id="adm-city" type="text" placeholder="City" style="width:100%;margin-bottom:6px;padding:8px;border-radius:6px;border:1px solid #eee"/>
  <input id="adm-address" type="text" placeholder="Address" style="width:100%;margin-bottom:6px;padding:8px;border-radius:6px;border:1px solid #eee"/>
  <textarea id="adm-menu" placeholder="Menu items (name:price, comma)" rows="3" style="width:100%;padding:8px;border-radius:6px;border:1px solid #eee"></textarea>
  <div style="display:flex;gap:8px;margin-top:8px">
    <button id="adm-add" class="btn">Add</button>
    <button id="admin-reset" class="small">Reset Demo</button>
  </div>
</aside>

<div id="modal-root"></div>

<footer style="text-align:center;margin-top:22px;color:var(--muted)">Prepared for SESD project ‚Äî Single-file deliverable</footer>

<script>
/* Single-file FoodFinder (Telangana) */
/* Storage keys */
const STORAGE = { USER:'fd_user', FAVS:'fd_favs', REVIEWS:'fd_reviews', CART:'fd_cart', RESTS:'fd_rests', ORDERS:'fd_orders' };

/* Telangana demo restaurants (20) */
const DEMO = [
  {id:1,name:"Paradise Biryani",cuisine:"Biryani",city:"Hyderabad",address:"Secunderabad",rating:4.6,menu:[{id:101,name:"Chicken Biryani",price:320},{id:102,name:"Mutton Biryani",price:420}]},
  {id:2,name:"Cafe Bahar",cuisine:"Biryani & Curries",city:"Hyderabad",address:"Basheerbagh",rating:4.4,menu:[{id:201,name:"Biryani",price:280},{id:202,name:"Kebab Plate",price:220}]},
  {id:3,name:"Bawarchi",cuisine:"Biryani",city:"Hyderabad",address:"RTC X Roads",rating:4.3,menu:[{id:301,name:"Hyderabadi Biryani",price:290}]},
  {id:4,name:"Shah Ghouse",cuisine:"Indian",city:"Hyderabad",address:"Tolichowki",rating:4.2,menu:[{id:401,name:"Haleem",price:240}]},
  {id:5,name:"Meghana Foods",cuisine:"Andhra",city:"Hyderabad",address:"Ameerpet",rating:4.4,menu:[{id:501,name:"Chicken 65",price:220}]},
  {id:6,name:"Rayalaseema Ruchulu",cuisine:"South Indian",city:"Hyderabad",address:"Jubilee Hills",rating:4.1,menu:[{id:601,name:"Spicy Goat Curry",price:260}]},
  {id:7,name:"Ulavacharu",cuisine:"Andhra",city:"Hyderabad",address:"Jubilee Hills",rating:4.3,menu:[{id:701,name:"Ulavacharu Curry",price:300}]},
  {id:8,name:"Cafe Niloufer",cuisine:"Bakery & Cafe",city:"Hyderabad",address:"Lakdikapool",rating:4.0,menu:[{id:801,name:"Double Ka Meetha",price:120}]},
  {id:9,name:"Chutneys",cuisine:"South Indian",city:"Hyderabad",address:"Panjagutta",rating:4.2,menu:[{id:901,name:"Idli Sambar",price:80}]},
  {id:10,name:"Pista House",cuisine:"Sweets & Bakery",city:"Hyderabad",address:"Charminar",rating:4.5,menu:[{id:1001,name:"Dry Fruits Sweets",price:420}]},
  {id:11,name:"Kakatiya Deluxe Mess",cuisine:"Local",city:"Warangal",address:"Kazipet",rating:4.0,menu:[{id:1101,name:"Home-style Meals",price:120}]},
  {id:12,name:"Swagath Grand",cuisine:"Multi Cuisine",city:"Warangal",address:"Hanamkonda",rating:4.1,menu:[{id:1201,name:"Veg Thali",price:150}]},
  {id:13,name:"Sitara Family Dhaba",cuisine:"Local",city:"Warangal",address:"Warangal West",rating:4.0,menu:[{id:1301,name:"Chicken Curry",price:180}]},
  {id:14,name:"Abhiruchi Hotel",cuisine:"Hotel",city:"Karimnagar",address:"Main Road",rating:4.1,menu:[{id:1401,name:"Meals",price:130}]},
  {id:15,name:"Sri Balaji Tiffins",cuisine:"Tiffins",city:"Karimnagar",address:"Old Town",rating:4.0,menu:[{id:1501,name:"Dosa",price:80}]},
  {id:16,name:"Anand Bhavan",cuisine:"Pure Veg",city:"Nizamabad",address:"Bazaar Road",rating:4.0,menu:[{id:1601,name:"Veg Meals",price:120}]},
  {id:17,name:"Alpha Hotel",cuisine:"Hotel",city:"Nizamabad",address:"Station Road",rating:3.9,menu:[{id:1701,name:"Chicken Fry",price:160}]},
  {id:18,name:"Green Bawarchi",cuisine:"Family Restaurant",city:"Khammam",address:"Main Bazaar",rating:4.0,menu:[{id:1801,name:"Royale Platter",price:260}]},
  {id:19,name:"Sahithi Restaurant",cuisine:"Multi Cuisine",city:"Nalgonda",address:"Market Area",rating:4.1,menu:[{id:1901,name:"Veg Biryani",price:150}]},
  {id:20,name:"Sri Sai Teja Mess",cuisine:"Local Mess",city:"Khammam",address:"Kothagudem Road",rating:3.8,menu:[{id:2001,name:"Meals",price:100}]}
];

/* Utilities */
const $ = id => document.getElementById(id);
const save = (k,v) => localStorage.setItem(k, JSON.stringify(v));
const load = (k, fallback) => { try { const s = localStorage.getItem(k); return s ? JSON.parse(s) : fallback; } catch(e){ return fallback; } };

/* SVG generator (copyright-free placeholders) */
function svgDataUri(name, idx=0, w=900, h=540){
  const bg = ['#eef6ff','#fff8f0','#f1fff6','#fff4f8'][idx%4];
  const accent = ['#13408a','#2f5ab3','#0a6b4a','#a63838'][idx%4];
  const safe = String(name).replace(/&/g,'&amp;').replace(/</g,'&lt;');
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='${w}' height='${h}'><rect width='100%' height='100%' rx='12' fill='${bg}'/><g transform='translate(24,24)'><rect width='320' height='200' rx='12' fill='${accent}' opacity='0.08'/></g><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='Inter, Arial' font-size='34' fill='${accent}'>${safe}</text><text x='50%' y='74%' dominant-baseline='middle' text-anchor='middle' font-size='13' fill='#2b3b47' opacity='0.7'>Telangana ‚Äî demo SVG</text></svg>`;
  return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
}

/* Initialize restaurants (attach gallery) */
let restaurants = null;
function initRestaurants(){
  const stored = load(STORAGE.RESTS, null);
  if(stored){
    restaurants = stored.map((r,i)=>{
      if(!r.img) r.img = svgDataUri(r.name, i);
      if(!r.gallery) { const g=[]; for(let k=0;k<4;k++) g.push(svgDataUri(r.name + ' ‚Äî view ' + (k+1), i+k)); r.gallery = g; }
      return r;
    });
    save(STORAGE.RESTS, restaurants);
  } else {
    restaurants = DEMO.map((r,i)=>{
      const gallery = [];
      for(let g=0; g<4; g++) gallery.push(svgDataUri(r.name + ' ‚Äî view ' + (g+1), i+g));
      return {...r, img: gallery[0], gallery};
    });
    save(STORAGE.RESTS, restaurants);
  }
}

/* Rendering UI */
const root = $('restaurants');

function initFilters(){
  const cities = Array.from(new Set(restaurants.map(r=>r.city))).sort();
  const cuisines = Array.from(new Set(restaurants.map(r=>r.cuisine))).sort();
  const cityEl = $('city-filter'); cityEl.innerHTML = '<option value="">All cities</option>'; cities.forEach(c=> cityEl.insertAdjacentHTML('beforeend', `<option value="${c}">${c}</option>`));
  const cuEl = $('cuisine-filter'); cuEl.innerHTML = '<option value="">All cuisines</option>'; cuisines.forEach(c=> cuEl.insertAdjacentHTML('beforeend', `<option value="${c}">${c}</option>`));
}

function avgRating(id){
  const revs = load(STORAGE.REVIEWS, {});
  const arr = revs[id] || [];
  if(arr.length===0) return null;
  return arr.reduce((a,b)=>a+b.rating,0)/arr.length;
}

function render(list){
  root.innerHTML = '';
  if(!list || list.length===0){ root.innerHTML = `<div style="padding:18px;background:white;border-radius:10px;text-align:center">No restaurants found</div>`; return; }
  const favs = load(STORAGE.FAVS, []);
  list.forEach(r=>{
    const avg = avgRating(r.id) ?? r.rating;
    const isFav = favs.includes(r.id);
    const card = document.createElement('article'); card.className='card';
    card.innerHTML = `
      <div class="hero"><img src="${r.img}" alt="${escapeHTML(r.name)}"></div>
      <div class="info">
        <div>
          <div style="display:flex;justify-content:space-between;align-items:flex-start">
            <div>
              <div class="title">${escapeHTML(r.name)}</div>
              <div class="muted">${escapeHTML(r.cuisine)} ‚Ä¢ ${escapeHTML(r.city)}</div>
            </div>
            <div style="text-align:right">
              <div class="rating">${(avg||0).toFixed(1)}</div>
            </div>
          </div>
          <div style="margin-top:8px" class="muted">${escapeHTML(r.address)}</div>
        </div>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="small view-btn" data-id="${r.id}">View</button>
          <button class="small fav-btn" data-id="${r.id}">${isFav? 'üíñ Favorited':'ü§ç Favorite'}</button>
        </div>
      </div>
    `;
    root.appendChild(card);
  });
}

/* escaping helper */
function escapeHTML(s){ return String(s||'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[c]); }

/* search & filter */
function filterAndShow(){
  const q = ($('q').value||'').toLowerCase().trim();
  const city = $('city-filter').value;
  const cuisine = $('cuisine-filter').value;
  const filtered = restaurants.filter(r=>{
    if(city && r.city !== city) return false;
    if(cuisine && r.cuisine !== cuisine) return false;
    if(!q) return true;
    return (r.name+' '+r.cuisine+' '+r.city+' '+r.address).toLowerCase().includes(q);
  });
  render(filtered);
}

/* click delegation for restaurant actions */
root.addEventListener('click', (e)=>{
  if(e.target.matches('.view-btn')) openRestaurant(+e.target.dataset.id);
  if(e.target.matches('.fav-btn')) { toggleFav(+e.target.dataset.id); filterAndShow(); }
});

/* favorites */
function toggleFav(id){
  const favs = load(STORAGE.FAVS, []);
  const i = favs.indexOf(id);
  if(i>=0) favs.splice(i,1); else favs.push(id);
  save(STORAGE.FAVS, favs);
}

/* open restaurant modal */
function openRestaurant(id){
  const r = restaurants.find(x=>x.id===id); if(!r) return;
  const reviews = load(STORAGE.REVIEWS, {}); const list = (reviews[id]||[]).slice().reverse();
  const avg = avgRating(id) ?? r.rating;
  const menuHtml = (r.menu||[]).map(m=>`<div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dashed #eee"><div><strong>${escapeHTML(m.name)}</strong><div class="muted">‚Çπ${m.price}</div></div><div><button class="small add-cart" data-rest="${r.id}" data-item="${m.id}" data-price="${m.price}" data-name="${escapeHTML(m.name)}">Add</button></div></div>`).join('');
  const galleryHtml = (r.gallery||[r.img]).map((g,idx)=>`<img src="${g}" alt="${escapeHTML(r.name)} view ${idx+1}">`).join('');
  const reviewsHtml = list.length? list.map(rv=>`<div style="padding:8px 0;border-top:1px solid #f1f3f7"><strong>${escapeHTML(rv.user)}</strong> ‚Ä¢ <span class="muted">${new Date(rv.ts).toLocaleString()}</span><div>Rating: ${rv.rating}/5</div><div>${escapeHTML(rv.text)}</div></div>`).join('') : '<div class="muted">No reviews yet</div>';

  openModal(`<div style="display:flex;flex-direction:column;gap:12px">
    <div style="display:flex;gap:12px;align-items:center">
      <img src="${r.img}" alt="" style="width:220px;height:140px;object-fit:cover;border-radius:8px"/>
      <div style="flex:1">
        <h3 style="margin:0">${escapeHTML(r.name)}</h3>
        <div class="muted">${escapeHTML(r.cuisine)} ‚Ä¢ ${escapeHTML(r.city)}</div>
        <div style="margin-top:6px"><strong>Avg rating:</strong> ${(avg||0).toFixed(1)}</div>
        <div class="muted" style="margin-top:6px">${escapeHTML(r.address)}</div>
      </div>
      <div><button class="small toggle-fav-modal" data-id="${r.id}">${load(STORAGE.FAVS,[]).includes(r.id)? 'üíñ Favorited':'ü§ç Favorite'}</button></div>
    </div>

    <div><h4 style="margin:6px 0">Gallery</h4><div class="gallery">${galleryHtml}</div></div>

    <div><h4 style="margin:6px 0">Menu</h4>${menuHtml}</div>

    <div><h4 style="margin:6px 0">Reviews</h4>${reviewsHtml}
      <div style="margin-top:8px">
        <h5>Add review</h5>
        <div style="display:flex;gap:8px;align-items:center;margin-top:6px">
          <label class="muted">Rating</label>
          <select id="rv-rating"><option>5</option><option>4</option><option>3</option><option>2</option><option>1</option></select>
        </div>
        <textarea id="rv-text" rows="3" style="width:100%;margin-top:8px;padding:8px;border-radius:8px;border:1px solid #eee"></textarea>
        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:6px"><button id="rv-submit" class="btn" data-id="${r.id}">Submit</button><button id="rv-cancel" class="small">Close</button></div>
      </div>
    </div>
  </div>`);

  // add to cart handlers
  document.querySelectorAll('.add-cart').forEach(btn=> btn.addEventListener('click', ()=>{
    const restId = +btn.dataset.rest, itemId=+btn.dataset.item, price=+btn.dataset.price, name=btn.dataset.name;
    addToCart({restId,itemId,name,price,qty:1}); updateCartUI(); alert(name + ' added to cart');
  }));
  document.querySelector('.toggle-fav-modal').addEventListener('click', ()=>{ toggleFav(id); document.querySelector('.toggle-fav-modal').textContent = load(STORAGE.FAVS,[]).includes(id)? 'üíñ Favorited' : 'ü§ç Favorite'; filterAndShow(); });
  document.getElementById('rv-cancel').addEventListener('click', closeModal);
  document.getElementById('rv-submit').addEventListener('click', ()=>{
    const rating = +document.getElementById('rv-rating').value; const text = document.getElementById('rv-text').value.trim();
    const user = load(STORAGE.USER, null);
    if(!user){ alert('Sign in to submit reviews'); return; }
    const reviews = load(STORAGE.REVIEWS, {});
    reviews[id] = reviews[id] || [];
    reviews[id].push({user:user.name, rating, text, ts: Date.now()});
    save(STORAGE.REVIEWS, reviews);
    closeModal(); filterAndShow(); alert('Review submitted');
  });
}

/* modal helpers */
function openModal(html){
  const root = $('modal-root'); const bg = document.createElement('div'); bg.className='modal-bg'; bg.innerHTML = `<div class="modal">${html}</div>`; bg.addEventListener('click', e=> { if(e.target===bg) closeModal(); }); root.appendChild(bg);
}
function closeModal(){ $('modal-root').innerHTML = ''; }

/* cart & orders */
function addToCart(item){
  const c = load(STORAGE.CART, []);
  item.restName = (restaurants.find(r=>r.id===item.restId)||{}).name || '';
  const found = c.find(i=>i.restId===item.restId && i.itemId===item.itemId);
  if(found) found.qty += item.qty; else c.push(item);
  save(STORAGE.CART, c);
}
function updateCartUI(){
  const cart = load(STORAGE.CART, []);
  const el = $('cart-items'); el.innerHTML = '';
  if(cart.length===0) el.innerHTML = '<div class="muted">Cart is empty</div>'; else {
    cart.forEach((it, idx)=>{
      const div = document.createElement('div'); div.className='cart-item'; div.style.display='flex'; div.style.justifyContent='space-between'; div.style.alignItems='center'; div.style.padding='8px 0'; div.style.borderBottom='1px dashed #eee';
      div.innerHTML = `<div><strong>${escapeHTML(it.name)}</strong><div class="muted">${escapeHTML(it.restName)}</div></div><div>‚Çπ${(it.price*it.qty).toFixed(0)} <div style="margin-top:6px"><button class="small remove-item" data-idx="${idx}">Remove</button></div></div>`;
      el.appendChild(div);
    });
    el.querySelectorAll('.remove-item').forEach(b=> b.addEventListener('click', ()=>{ const i=+b.dataset.idx; const c=load(STORAGE.CART,[]); c.splice(i,1); save(STORAGE.CART,c); updateCartUI(); }));
  }
  const total = load(STORAGE.CART,[]).reduce((s,i)=>s + i.price*i.qty, 0);
  $('cart-total').textContent = total.toFixed(0);
  $('cart-toggle').textContent = `Cart (${load(STORAGE.CART,[]).reduce((s,i)=>s+i.qty,0)})`;
}

/* checkout */
$('checkout').addEventListener('click', ()=> {
  const user = load(STORAGE.USER, null);
  if(!user){ alert('Sign in to checkout'); return; }
  const cart = load(STORAGE.CART, []);
  if(cart.length===0){ alert('Cart empty'); return; }
  const orders = load(STORAGE.ORDERS, []); const order = {id:'ORD'+Date.now(), user:user.name, email:user.email, items:cart, total: cart.reduce((s,i)=>s+i.price*i.qty,0), ts: Date.now()};
  orders.push(order); save(STORAGE.ORDERS, orders);
  alert(`Order placed: ${order.id} ‚Äî Total ‚Çπ${order.total.toFixed(0)}. Thank you.`);
  save(STORAGE.CART, []); updateCartUI(); $('cart').classList.add('hidden');
});

/* Sign in (local demo) */
$('signin-btn').addEventListener('click', ()=>{
  const u = load(STORAGE.USER, null);
  if(u){ if(confirm('Sign out?')){ localStorage.removeItem(STORAGE.USER); $('signed-as').textContent='Not signed in'; $('signin-btn').textContent='Sign In'; } return; }
  openModal(`<div style="display:flex;flex-direction:column;gap:8px"><h3>Sign In</h3><input id="si-name" placeholder="Name" style="padding:8px;border-radius:6px;border:1px solid #eee"/><input id="si-email" placeholder="Email" style="padding:8px;border-radius:6px;border:1px solid #eee"/><div style="display:flex;justify-content:flex-end;gap:8px"><button id="si-submit" class="btn">Sign In</button><button id="si-cancel" class="small">Cancel</button></div></div>`);
  document.getElementById('si-cancel').addEventListener('click', closeModal);
  document.getElementById('si-submit').addEventListener('click', ()=>{ const name=$('si-name').value.trim(), email=$('si-email').value.trim(); if(!name||!email){ alert('Enter name and email'); return; } save(STORAGE.USER,{name,email}); $('signed-as').textContent=`Signed in: ${name}`; $('signin-btn').textContent='Sign Out'; closeModal(); alert('Signed in'); });
});

/* Admin add/reset */
$('admin-toggle').addEventListener('click', ()=>{ const p=$('admin-panel'); p.classList.toggle('hidden'); });
$('adm-add').addEventListener('click', ()=>{ const name=$('adm-name').value.trim(); if(!name){ alert('Enter name'); return; } const cuisine=$('adm-cuisine').value.trim()||'Various'; const city=$('adm-city').value.trim()||'City'; const addr=$('adm-address').value.trim()||''; const menuRaw=$('adm-menu').value.trim(); const menu=[]; if(menuRaw) menuRaw.split(',').forEach((s,i)=>{ const [n,p]=s.split(':'); if(n) menu.push({id:Date.now()%100000 + i, name:n.trim(), price: +(p||150)}); }); const newId = Math.max(0,...restaurants.map(r=>r.id)) + 1; const gallery=[]; for(let i=0;i<4;i++) gallery.push(svgDataUri(name + ' ‚Äî view ' + (i+1), newId + i)); const r={id:newId,name,cuisine,city,address:addr,rating:4.0,menu,img:gallery[0],gallery}; restaurants.push(r); save(STORAGE.RESTS, restaurants); initFilters(); filterAndShow(); alert('Added locally'); $('adm-name').value=''; $('adm-cuisine').value=''; $('adm-city').value=''; $('adm-address').value=''; $('adm-menu').value=''; });
$('admin-reset').addEventListener('click', ()=>{ if(!confirm('Reset to demo data?')) return; localStorage.removeItem(STORAGE.RESTS); localStorage.removeItem(STORAGE.FAVS); localStorage.removeItem(STORAGE.REVIEWS); localStorage.removeItem(STORAGE.CART); localStorage.removeItem(STORAGE.ORDERS); initRestaurants(); initFilters(); filterAndShow(); alert('Reset done'); });

/* Export data */
$('export-btn').addEventListener('click', ()=>{ const payload={restaurants, favs:load(STORAGE.FAVS,[]), reviews:load(STORAGE.REVIEWS,{}), user:load(STORAGE.USER,null), cart:load(STORAGE.CART,[]), orders:load(STORAGE.ORDERS,[])}; const a=document.createElement('a'); a.href='data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(payload, null, 2)); a.download='telangana-foodfinder-export.json'; a.click(); });

/* Helpers and boot */
function updateSignedUI(){ const u = load(STORAGE.USER, null); $('signed-as').textContent = u? `Signed in: ${u.name}` : 'Not signed in'; $('signin-btn').textContent = u? 'Sign Out' : 'Sign In'; }
function updateCartCount(){ $('cart-toggle').textContent = `Cart (${load(STORAGE.CART,[]).reduce((s,i)=>s+i.qty,0)})`; }

$('search-btn').addEventListener('click', filterAndShow);
$('reset-btn').addEventListener('click', ()=>{ $('q').value=''; $('city-filter').value=''; $('cuisine-filter').value=''; filterAndShow(); });

/* Setup + initial render */
initRestaurants(); initFilters(); render(restaurants); updateSignedUI(); updateCartUI();

/* Show favorites */
$('show-favs').addEventListener('click', ()=>{ const favs = load(STORAGE.FAVS, []); render(restaurants.filter(r=> favs.includes(r.id))); });

/* Cart toggle */
$('cart-toggle').addEventListener('click', ()=>{ const c=$('cart'); c.classList.toggle('hidden'); updateCartUI(); });

/* storage event to sync across tabs */
window.addEventListener('storage', ()=>{ initRestaurants(); initFilters(); render(restaurants); updateCartUI(); });

</script>
</body>
</html>
